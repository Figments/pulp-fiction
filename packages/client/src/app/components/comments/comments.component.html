<ng-container *ngIf="loading">
    <div class="loader">
        <div class="lds-dual-ring"></div>
    </div>
</ng-container>

<ng-container *ngIf="!loading">
    <div class="comments-topbar">
        <div class="paginator">
            <pagination-controls [nextLabel]="''" [previousLabel]="''" (pageChange)="pageNum = $event" id="comments"></pagination-controls>
        </div>
        <div class="create-comment">
            <button title="New Comment" (click)="newComment(itemId, itemKind)"><i-feather name="message-circle"></i-feather></button>
            <button title="Refresh Thread" style="border-left: 0; border-right: 0;"><i-feather name="refresh-cw"></i-feather></button>
            <button title="Thread Settings"><i-feather name="settings"></i-feather></button>
        </div>
    </div>

    <div class="comments-container">
        <div class="loader" *ngIf="loading">
            <div class="lds-dual-ring"></div>
        </div>
        <div style="margin-top: 2rem; text-align: center;" *ngIf="comments.length === 0">
            <h4 style="margin-bottom: 0;">No one's said anything yet...</h4>
            <p style="margin-top: 0; font-style: italic;">But you could be the first!</p>
        </div>
        <div class="comment" *ngFor="let comment of comments | paginate: { id: 'comments', itemsPerPage: 5, currentPage: pageNum, totalItems: comments.length }; let i = index">
            <div class="row">
                <div class="comm-side-header three columns">
                    <img [src]="comment.user.profile.avatar">
                    <h3 class="comm-user">
                        <a [routerLink]="['/portfolio', comment.user._id, comment.user.username | slugify]">{{ comment.user.username }}</a>
                    </h3>
                    <span class="comm-created-at">
                        <div style="text-align: center;">
                            {{ comment.createdAt | date: 'mediumDate'}}
                        </div>
                        <div style="text-align: center;">
                            {{ comment.createdAt | date: 'mediumTime' }}
                        </div>
                    </span>
                </div>
                <div class="comm-body-box nine columns">
                    <div class="comm-meta-panel">
                        <span class="comm-id">#{{ i + 1 }}</span>
                        <span class="comm-controls">
                            <a><i-feather name="edit-3"></i-feather></a>
                        </span>
                        <ng-template #notThisUser>
                            <span class="comm-controls" *ngIf="currentUser">
                                <a><i-feather name="corner-up-left"></i-feather></a>
                                <a><i-feather name="flag"></i-feather></a>
                            </span>
                        </ng-template>
                    </div>
                    <div class="comm-body">
                        <quill-view [content]="comment.body" sanitize="true" format="json"></quill-view>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="comments-bottom-bar">
        <div class="paginator">
            <pagination-controls [nextLabel]="''" [previousLabel]="''" (pageChange)="pageNum = $event" id="comments"></pagination-controls>
        </div>
        <div class="create-comment">
            <button title="New Comment" (click)="newComment(itemId, itemKind)"><i-feather name="message-circle"></i-feather></button>
            <button title="Refresh Thread" style="border-left: 0; border-right: 0;"><i-feather name="refresh-cw"></i-feather></button>
            <button title="Thread Settings"><i-feather name="settings"></i-feather></button>
        </div>
    </div>
</ng-container>