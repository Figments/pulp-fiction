<div class="search-nav">
    <div class="search-bar">
        <form [formGroup]="searchForm" (ngSubmit)="submitSearch()">
            <input formControlName="query" type="text" class="u-full-width" placeholder="Search ...">
        </form>
    </div>
</div>

<ng-container *ngIf="route.children.length === 0">
    <ng-container *ngIf="initialResults === undefined; else resultsAreIn">
        <div style="text-align: center;">
            <h3 style="margin-bottom: 0;">You haven't searched for anything yet...</h3>
            <p style="margin-top: 0; margin-bottom: 0;">Type your query in the search bar and hit enter.</p>
            <p style="margin-top: 0;">The first six works/blogs/users will show up here.</p>
        </div>
    </ng-container>
    <ng-template #resultsAreIn>
        <div class="search-results">

            <!--Works-->
            <div class="results">
                <div class="results-header">
                    <i-feather name="feather"></i-feather>
                    <h3>Top Works</h3>
                    <span class="see-more" *ngIf="initialResults.works.totalDocs !== 0 && initialResults.works.totalDocs > 6">
                        <a [routerLink]="['/search/works']">See {{ initialResults.works.totalDocs - 6 }} more</a>
                    </span>
                </div>
                <div class="results-body">
                    <ng-container *ngIf="initialResults.works.totalDocs === 0; else noWorks">
                        <div style="text-align: center; margin-top: 1.25rem;">
                            <h3 style="margin-bottom: 0;">No works found</h3>
                            <p style="margin-top: 0; margin-bottom: 0;">Were you looking for something here?</p>
                        </div>
                    </ng-container>
                    <ng-template #noWorks>
                        <div class="works-feed">
                            <div *ngFor="let work of initialResults.works.docs">
                                <div class="work-container">
                                    <!--Header-->
                                    <div class="work-header">
                                        <ng-container [ngSwitch]="work.meta.rating">
                                            <div class="rating everyone small" *ngSwitchDefault>E</div>
                                            <div class="rating teen small" *ngSwitchCase="'Teen'">T</div>
                                            <div class="rating mature small" *ngSwitchCase="'Mature'">M</div>
                                            <div class="rating explicit small" *ngSwitchCase="'Explicit'">X</div>                                
                                        </ng-container>                            
                                        <h1><a [routerLink]="['/work', work._id, work.title | slugify]">{{ work.title }}</a></h1>                            
                                        <h2>by <a [routerLink]="['/portfolio', work.author._id, work.author.username | slugify]">{{ work.author.username }}</a></h2>
                                        <div class="approval" title="Approval Rating">
                                            <i-feather name="heart"></i-feather>{{ calcApprovalRating(work.stats.likes, work.stats.dislikes) }}%
                                        </div>
                                        <div class="category-genre">
                                            {{ work.meta.category | fixCategories }}<span>//</span>{{ work.meta.genres | separateEntities:work.meta.category }}<ng-container *ngIf="work.meta.fandoms.length > 0"><span>//</span>{{ work.meta.fandoms | separateEntities }}</ng-container>
                                        </div>                            
                                    </div>
            
                                    <!--Short description-->
                                    <div class="short-description">
                                        <div *ngIf="work.meta.coverArt">
                                            <img class="cover-art bordered-cover-art" [src]="work.meta.coverArt">
                                        </div>
                                        <div>
                                            {{ work.shortDesc }}
                                        </div>
                                    </div>
            
                                    <!--Work stats-->
                                    <div class="work-stats">
                                        <i-feather name="bar-chart-2" title="Views"></i-feather>{{ work.stats.views | abbreviate }}<span>//</span>
                                        <i-feather name="message-circle" title="Comments"></i-feather>{{ work.stats.comments | abbreviate }}<span>//</span>
                                        <i-feather name="pen-tool" title="Words"></i-feather>{{ work.stats.totWords | abbreviate }}<span>//</span>
                                        <i-feather name="calendar" title="Published On"></i-feather>{{ work.audit.publishedOn | date:'mediumDate' }}<span>//</span>
                                        {{ work.meta.status }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>

            <!--Blogs-->
            <div class="results">
                <div class="results-header">
                    <i-feather name="coffee"></i-feather>
                    <h3>Top Blogs</h3>
                    <span class="see-more" *ngIf="initialResults.blogs.totalDocs !== 0 && initialResults.blogs.totalDocs > 6">
                        <a [routerLink]="['/search/blogs']">See {{ initialResults.blogs.totalDocs - 6 }} more</a>
                    </span>
                </div>
                <div class="results-body">
                    <ng-container *ngIf="initialResults.blogs.totalDocs === 0; else noBlogs">
                        <div style="text-align: center; margin-top: 1.25rem;">
                            <h3 style="margin-bottom: 0;">No blogs found</h3>
                            <p style="margin-top: 0; margin-bottom: 0;">Were you looking for something here?</p>
                        </div>
                    </ng-container>
                    <ng-template #noBlogs>

                    </ng-template>
                </div>
            </div>

            <!--Users-->
            <div class="results">
                <div class="results-header">
                    <i-feather name="user"></i-feather>
                    <h3>Top Users</h3>
                    <span class="see-more" *ngIf="initialResults.users.totalDocs !== 0 && initialResults.users.totalDocs > 6">
                        <a [routerLink]="['/search/users']">See {{ initialResults.users.totalDocs - 6 }} more</a>
                    </span>
                </div>
                <div class="results-body">
                    <ng-container *ngIf="initialResults.users.totalDocs === 0; else noUsers">
                        <div style="text-align: center; margin-top: 1.25rem;">
                            <h3 style="margin-bottom: 0;">No users found</h3>
                            <p style="margin-top: 0; margin-bottom: 0;">Were you looking for something here?</p>
                        </div>
                    </ng-container>
                    <ng-template #noUsers>

                    </ng-template>
                </div>
            </div>
        </div>
    </ng-template>
</ng-container>

<router-outlet></router-outlet>
