<div class="tools">
    <div class="tool-buttons">
        <ng-container *ngIf="poetryView; else proseView">
            <button matRipple class="tool left" (click)="switchView()"><i-feather name="book-open"></i-feather>Prose</button>
            <button matRipple class="tool end active"><i-feather name="feather"></i-feather>Poetry</button>
        </ng-container>
        <ng-template #proseView>
            <button matRipple class="tool left active"><i-feather name="book-open"></i-feather>Prose</button>
            <button matRipple class="tool end" (click)="switchView()"><i-feather name="feather"></i-feather>Poetry</button>
        </ng-template>
    </div>
    <form [formGroup]="searchWorks" class="tool-search" (ngSubmit)="searchFor()">
        <div class="search-bar">
            <input type="text" formControlName="query" class="search-input" placeholder="Search works...">
            <button matRipple class="search-submit" type="submit"><i-feather name="search"></i-feather></button>
        </div>
    </form>
</div>

<ng-container *ngIf="poetryView; else showProse">
    <div class="works-feed" *ngIf="poetryData.totalDocs !== 0; else noGalleryWorks">
        <ng-container *ngFor="let work of poetryData.docs | paginate: {
            itemsPerPage: poetryData.limit,
            currentPage: pageNum,
            totalItems: poetryData.totalDocs
        }">
            <div class="work-container">
                <!--Header-->
                <div class="work-header">
                    <rating-icon [rating]="work.meta.rating" [size]="'small'"></rating-icon>                      
                    <h1><a [routerLink]="['/work', work._id, work.title | slugify]">{{ work.title }}</a></h1>                            
                    <h2>by <a [routerLink]="['/portfolio', work.author._id, work.author.username | slugify]">{{ work.author.username }}</a></h2>
                    <div class="category-genre">
                        <span class="tag" [matTooltip]="'Prose'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="book-open" class="kind"></i-feather></span>
                        <span class="divider">//</span>
                        <span class="tag">{{ work.meta.category }}</span>
                        <span class="divider">//</span>
                        <span class="tag">{{ work.meta.genres | separateEntities }}</span>
                        <span class="tag right"><i-feather name="heart"></i-feather>{{ calcApprovalRating(work.stats.likes, work.stats.dislikes) }}%</span>
                    </div>                            
                </div>

                <!--Short description-->
                <div class="short-description">
                    <div *ngIf="work.meta.coverArt">
                        <img class="cover-art bordered-cover-art" [src]="work.meta.coverArt">
                    </div>
                    <div>
                        {{ work.desc }}
                    </div>
                </div>

                <!--Work stats-->
                <div class="work-stats">
                    <i-feather name="bar-chart-2" title="Views"></i-feather>{{ work.stats.views | abbreviate }}<span>//</span>
                    <i-feather name="message-circle" title="Comments"></i-feather>{{ work.stats.comments | abbreviate }}<span>//</span>
                    <i-feather name="pen-tool" title="Words"></i-feather>{{ work.stats.words | abbreviate }}<span>//</span>
                    <i-feather name="calendar" title="Published On"></i-feather>{{ work.meta.publishedOn | date:'shortDate' }}<span>//</span>
                    {{ work.meta.status }}
                </div>
            </div>
        </ng-container>
    </div>
    <ng-template #noGalleryWorks>
        <div class="empty">
            <h3>There's nothing here...</h3>
            <p *ngIf="currentUserIsSame(); else notSameUser">Why not head to My Stuff and add some new poetry?</p>
            <ng-template #notSameUser>
                <p>Check back later to see if {{ portUser.username }} adds anything!</p>
            </ng-template>
        </div>
    </ng-template>
    <pagination-controls (pageChange)="onPageChange($event)" previousLabel="" nextLabel=""></pagination-controls>
</ng-container>

<ng-template #showProse>
    <div class="works-feed" *ngIf="proseData.totalDocs !== 0; else noGalleryWorks">
        <ng-container *ngFor="let work of proseData.docs | paginate: {
            itemsPerPage: proseData.limit,
            currentPage: pageNum,
            totalItems: proseData.totalDocs
        }">
            <div class="work-container">
                <!--Header-->
                <div class="work-header">
                    <rating-icon [rating]="work.meta.rating" [size]="'small'"></rating-icon>                      
                    <h1><a [routerLink]="['/work', work._id, work.title | slugify]">{{ work.title }}</a></h1>                            
                    <h2>by <a [routerLink]="['/portfolio', work.author._id, work.author.username | slugify]">{{ work.author.username }}</a></h2>
                    <div class="category-genre">
                        <span class="tag" [matTooltip]="'Prose'" [matTooltipClass]="'offprint-tooltip'"><i-feather name="book-open" class="kind"></i-feather></span>
                        <span class="divider">//</span>
                        <span class="tag">{{ work.meta.category }}</span>
                        <span class="divider">//</span>
                        <span class="tag">{{ work.meta.genres | separateEntities }}</span>
                        <span class="tag right"><i-feather name="heart"></i-feather>{{ calcApprovalRating(work.stats.likes, work.stats.dislikes) }}%</span>
                    </div>                            
                </div>

                <!--Short description-->
                <div class="short-description">
                    <div *ngIf="work.meta.coverArt">
                        <img class="cover-art bordered-cover-art" [src]="work.meta.coverArt">
                    </div>
                    <div>
                        {{ work.desc }}
                    </div>
                </div>

                <!--Work stats-->
                <div class="work-stats">
                    <i-feather name="bar-chart-2" title="Views"></i-feather>{{ work.stats.views | abbreviate }}<span>//</span>
                    <i-feather name="message-circle" title="Comments"></i-feather>{{ work.stats.comments | abbreviate }}<span>//</span>
                    <i-feather name="pen-tool" title="Words"></i-feather>{{ work.stats.words | abbreviate }}<span>//</span>
                    <i-feather name="calendar" title="Published On"></i-feather>{{ work.meta.publishedOn | date:'shortDate' }}<span>//</span>
                    {{ work.meta.status }}
                </div>
            </div>
        </ng-container>
    </div>
    <ng-template #noGalleryWorks>
        <div class="empty">
            <h3>There's nothing here...</h3>
            <p *ngIf="currentUserIsSame(); else notSameUser">Why not head to My Stuff and add some new prose?</p>
            <ng-template #notSameUser>
                <p>Check back later to see if {{ portUser.username }} adds anything!</p>
            </ng-template>
        </div>
    </ng-template>
    <pagination-controls (pageChange)="onPageChange($event)" previousLabel="" nextLabel=""></pagination-controls>
</ng-template>
